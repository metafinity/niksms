<dashboard version="1.1" hideEdit="true">
    <label>Send Niksms Message v1.0.0</label>

    <!-- Overview & Quickstart Panel -->
    <row>
        <panel>
            <html>
            <style>
                body { font-family: Arial, sans-serif; line-height: 1.5; color: #333; }
                h1 { color: #2E5C6E; }
                hr { border: 0; border-top: 1px solid #ccc; margin: 15px 0; }
                table { border-collapse: collapse; width: 100%; margin-bottom: 15px; }
                th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
                th { background-color: #f2f2f2; }
                .card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin: 10px 0; background-color: #f9f9f9; display: inline-block; width: 45%; vertical-align: top; }
                .card h2 { margin-top: 0; color: #2E5C6E; }
            </style>

            <h1>Overview</h1>
            <p>This is a Splunk Modular Alert for sending SMS messages to a group of phone numbers using the Niksms API.</p>
            <p>The Python code in this App is Python 3 compatible and supports Splunk 8+.</p>
            <p>All activities, including API requests, responses, and errors, are logged to:</p>
            <pre>$SPLUNK_HOME/var/log/splunk/niksms_alert.log</pre>
            <hr/>

            <h1>Quickstart</h1>
            <ol>
                <li>Sign up on <a href="https://webservice.niksms.com/" target="_blank">Niksms</a> and obtain your API key.</li>
                <li>Configure the custom alert action in Splunk with the following parameters:
                    <ul>
                        <li><b>API Key</b> → Your Niksms API key</li>
                        <li><b>Sender Number</b> → Optional sender number</li>
                        <li><b>Phones</b> → Comma-separated recipient phone numbers</li>
                        <li><b>Message</b> → Message text (supports result tokens, e.g. $result.fieldname$)</li>
                    </ul>
                </li>
                <li>Trigger an alert and the App will automatically send SMS to the configured recipients.</li>
            </ol>
            <hr/>

            <h1>Parameters</h1>
            <table>
                <tr><th>Parameter</th><th>Required</th><th>Description</th></tr>
                <tr><td>apikey</td><td>Yes</td><td>Your Niksms API key</td></tr>
                <tr><td>sender</td><td>No</td><td>Optional sender number</td></tr>
                <tr><td>phones</td><td>Yes</td><td>Comma-separated recipient phone numbers</td></tr>
                <tr><td>message</td><td>Yes</td><td>Message text (supports result tokens)</td></tr>
            </table>
            <hr/>

            <h1>Logging</h1>
            <ul>
                <li>Received payload</li>
                <li>API request and response details</li>
                <li>Errors if sending fails</li>
            </ul>
            <hr/>

            <h1>Developer</h1>
            <p>This App is built and supported by <a href="https://github.com/metafinity/niksms_alert" target="_blank">Meysam Talebi</a>.</p>

            </html>
        </panel>
    </row>

    <!-- Panel Credit & Expire Date -->
    <row>
        <panel>
            <html>
            <style>
                .status-card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin: 10px; background-color: #f1f9ff; display: inline-block; width: 45%; text-align: center; }
                .status-card h2 { color: #2E5C6E; margin: 0 0 10px 0; }
                .status-card p { font-size: 1.2em; margin: 0; }
            </style>

            <h1>Panel Status</h1>
            <div id="credit-card" class="status-card">
                <h2>Credit</h2>
                <p id="credit-value">Loading...</p>
            </div>
            <div id="expire-card" class="status-card">
                <h2>Panel Expiry Date</h2>
                <p id="expire-value">Loading...</p>
            </div>

            <script>
                // Example: fetch credit and expire date from Splunk search or endpoint
                require(['splunkjs/mvc/simplexml/ready!'], function() {
                    // Dummy values for now, replace with actual search results or endpoint
                    var credit = "$result.credit$" || "0";
                    var expire = "$result.expire_date$" || "N/A";
                    document.getElementById('credit-value').innerText = credit;
                    document.getElementById('expire-value').innerText = expire;
                });
            </script>

            </html>
        </panel>
    </row>

</dashboard>
